import{a as Se,V as _e}from"./form-BicW4gQW.js";import{m as Ie,u as Fe,a as Ae}from"./VSelect-Do7Cjzp8.js";import{m as Pe,V as X}from"./VTextField-5DMZp_lA.js";import{a2 as De,aI as Re,az as Me,bH as Te,r as N,a5 as A,aJ as Y,a6 as h,bI as Ee,cG as Le,w as P,b0 as Z,cr as Ne,aa as Be,b as u,F as O,s as D,a0 as ee,d3 as $e,bM as Oe,v as ze,d8 as Ke,dp as Ue,d as He,d4 as le,o as te,c as je,n as B,g as qe,z as Ge,d5 as Je,i as We,f as Qe,A as Xe,bk as ae,bl as ne,y as Ye}from"./index-DgFvbB8d.js";import{m as Ze,u as el}from"./filter-BVzRO1KW.js";import{f as ll}from"./forwardRefs-C-GTDzx5.js";import{u as tl,t as $,V as al,a as oe}from"./VList-CtXTIc9A.js";import{m as nl}from"./index-DEbPaM5s.js";import{V as ol}from"./VMenu-D8eaa84v.js";import{V as ul}from"./VCheckboxBtn-Dl7-FJ_e.js";import{V as sl}from"./VAvatar-f6tZ8_DQ.js";import{V as il}from"./VChip-D1yE6yXL.js";function rl(e,m,C){if(m==null)return e;if(Array.isArray(m))throw new Error("Multiple matches is not implemented");return typeof m=="number"&&~m?u(O,null,[u("span",{class:"v-combobox__unmask"},[e.substr(0,m)]),u("span",{class:"v-combobox__mask"},[e.substr(m,C)]),u("span",{class:"v-combobox__unmask"},[e.substr(m+C)])]):e}const cl=De({autoSelectFirst:{type:[Boolean,String]},clearOnSelect:{type:Boolean,default:!0},delimiters:Array,...Ze({filterKeys:["title"]}),...Ie({hideNoData:!0,returnObject:!0}),...Re(Pe({modelValue:null,role:"combobox"}),["validationValue","dirty","appendInnerIcon"]),...nl({transition:!1})},"VCombobox"),vl=Me()({name:"VCombobox",props:cl(),emits:{"update:focused":e=>!0,"update:modelValue":e=>!0,"update:search":e=>!0,"update:menu":e=>!0},setup(e,m){var J;let{emit:C,slots:a}=m;const{t:k}=Te(),x=N(),b=A(!1),p=A(!0),R=A(!1),j=N(),q=N(),z=Y(e,"menu"),r=h({get:()=>z.value,set:l=>{var n;z.value&&!l&&((n=j.value)!=null&&n.Î¨openChildren)||(z.value=l)}}),s=A(-1);let K=!1;const ue=h(()=>{var l;return(l=x.value)==null?void 0:l.color}),G=h(()=>r.value?e.closeText:e.openText),{items:se,transformIn:ie,transformOut:re}=tl(e),{textColorClasses:ce,textColorStyles:ve}=Ee(ue),o=Y(e,"modelValue",[],l=>ie(Le(l)),l=>{const n=re(l);return e.multiple?n:n[0]??null}),I=Se(),F=A(e.multiple?"":((J=o.value[0])==null?void 0:J.title)??""),c=h({get:()=>F.value,set:l=>{var n;if(F.value=l??"",e.multiple||(o.value=[$(e,l)]),l&&e.multiple&&((n=e.delimiters)!=null&&n.length)){const i=l.split(new RegExp(`(?:${e.delimiters.join("|")})+`));i.length>1&&(i.forEach(d=>{d=d.trim(),d&&V($(e,d))}),F.value="")}l||(s.value=-1),p.value=!l}}),de=h(()=>typeof e.counterValue=="function"?e.counterValue(o.value):typeof e.counterValue=="number"?e.counterValue:e.multiple?o.value.length:c.value.length);P(F,l=>{K?Z(()=>K=!1):b.value&&!r.value&&(r.value=!0),C("update:search",l)}),P(o,l=>{var n;e.multiple||(F.value=((n=l[0])==null?void 0:n.title)??"")});const{filteredItems:M,getMatches:fe}=el(e,se,()=>p.value?"":c.value),g=h(()=>e.hideSelected?M.value.filter(l=>!o.value.some(n=>n.value===l.value)):M.value),me=h(()=>o.value.map(l=>l.value)),T=h(()=>{var n;return(e.autoSelectFirst===!0||e.autoSelectFirst==="exact"&&c.value===((n=g.value[0])==null?void 0:n.title))&&g.value.length>0&&!p.value&&!R.value}),U=h(()=>e.hideNoData&&!g.value.length||e.readonly||(I==null?void 0:I.isReadonly.value)),H=N(),{onListScroll:be,onListKeydown:he}=Fe(H,x);function pe(l){K=!0,e.openOnClear&&(r.value=!0)}function ge(){U.value||(r.value=!0)}function xe(l){U.value||(b.value&&(l.preventDefault(),l.stopPropagation()),r.value=!r.value)}function Ve(l){var d;if(Ue(l)||e.readonly||I!=null&&I.isReadonly.value)return;const n=x.value.selectionStart,i=o.value.length;if((s.value>-1||["Enter","ArrowDown","ArrowUp"].includes(l.key))&&l.preventDefault(),["Enter","ArrowDown"].includes(l.key)&&(r.value=!0),["Escape"].includes(l.key)&&(r.value=!1),["Enter","Escape","Tab"].includes(l.key)&&(T.value&&["Enter","Tab"].includes(l.key)&&V(M.value[0]),p.value=!0),l.key==="ArrowDown"&&T.value&&((d=H.value)==null||d.focus("next")),!!e.multiple){if(["Backspace","Delete"].includes(l.key)){if(s.value<0){l.key==="Backspace"&&!c.value&&(s.value=i-1);return}const t=s.value,v=o.value[s.value];v&&!v.props.disabled&&V(v,!1),s.value=t>=i-1?i-2:t}if(l.key==="ArrowLeft"){if(s.value<0&&n>0)return;const t=s.value>-1?s.value-1:i-1;o.value[t]?s.value=t:(s.value=-1,x.value.setSelectionRange(c.value.length,c.value.length))}if(l.key==="ArrowRight"){if(s.value<0)return;const t=s.value+1;o.value[t]?s.value=t:(s.value=-1,x.value.setSelectionRange(0,0))}l.key==="Enter"&&c.value&&(V($(e,c.value)),c.value="")}}function ye(){var l;b.value&&(p.value=!0,(l=x.value)==null||l.focus())}function V(l){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(e.multiple){const i=o.value.findIndex(t=>e.valueComparator(t.value,l.value)),d=n??!~i;if(~i){const t=d?[...o.value,l]:[...o.value];t.splice(i,1),o.value=t}else d&&(o.value=[...o.value,l]);e.clearOnSelect&&(c.value="")}else{const i=n!==!1;o.value=i?[l]:[],F.value=i?l.title:"",Z(()=>{r.value=!1,p.value=!0})}}function Ce(l){b.value=!0,setTimeout(()=>{R.value=!0})}function ke(l){R.value=!1}function we(l){(l==null||l===""&&!e.multiple)&&(o.value=[])}return P(b,(l,n)=>{l||l===n||(s.value=-1,r.value=!1,T.value&&!R.value&&!o.value.some(i=>{let{value:d}=i;return d===g.value[0].value})?V(g.value[0]):e.multiple&&c.value&&V($(e,c.value)))}),P(r,()=>{if(!e.hideSelected&&r.value&&o.value.length){const l=g.value.findIndex(n=>o.value.some(i=>e.valueComparator(i.value,n.value)));Ne&&window.requestAnimationFrame(()=>{var n;l>=0&&((n=q.value)==null||n.scrollToIndex(l))})}}),P(g,(l,n)=>{b.value&&(!l.length&&e.hideNoData&&(r.value=!1),!n.length&&l.length&&(r.value=!0))}),Be(()=>{const l=!!(e.chips||a.chip),n=!!(!e.hideNoData||g.value.length||a["prepend-item"]||a["append-item"]||a["no-data"]),i=o.value.length>0,d=X.filterProps(e);return u(X,D({ref:x},d,{modelValue:c.value,"onUpdate:modelValue":[t=>c.value=t,we],focused:b.value,"onUpdate:focused":t=>b.value=t,validationValue:o.externalValue,counterValue:de.value,dirty:i,class:["v-combobox",{"v-combobox--active-menu":r.value,"v-combobox--chips":!!e.chips,"v-combobox--selection-slot":!!a.selection,"v-combobox--selecting-index":s.value>-1,[`v-combobox--${e.multiple?"multiple":"single"}`]:!0},e.class],style:e.style,readonly:e.readonly,placeholder:i?void 0:e.placeholder,"onClick:clear":pe,"onMousedown:control":ge,onKeydown:Ve}),{...a,default:()=>u(O,null,[u(ol,D({ref:j,modelValue:r.value,"onUpdate:modelValue":t=>r.value=t,activator:"parent",contentClass:"v-combobox__content",disabled:U.value,eager:e.eager,maxHeight:310,openOnClick:!1,closeOnContentClick:!1,transition:e.transition,onAfterLeave:ye},e.menuProps),{default:()=>[n&&u(al,D({ref:H,selected:me.value,selectStrategy:e.multiple?"independent":"single-independent",onMousedown:t=>t.preventDefault(),onKeydown:he,onFocusin:Ce,onFocusout:ke,onScrollPassive:be,tabindex:"-1","aria-live":"polite",color:e.itemColor??e.color},e.listProps),{default:()=>{var t,v,y;return[(t=a["prepend-item"])==null?void 0:t.call(a),!g.value.length&&!e.hideNoData&&(((v=a["no-data"])==null?void 0:v.call(a))??u(oe,{title:k(e.noDataText)},null)),u(Ae,{ref:q,renderless:!0,items:g.value},{default:w=>{var Q;let{item:f,index:S,itemRef:_}=w;const W=D(f.props,{ref:_,key:S,active:T.value&&S===0?!0:void 0,onClick:()=>V(f,null)});return((Q=a.item)==null?void 0:Q.call(a,{item:f,index:S,props:W}))??u(oe,W,{prepend:E=>{let{isSelected:L}=E;return u(O,null,[e.multiple&&!e.hideSelected?u(ul,{key:f.value,modelValue:L,ripple:!1,tabindex:"-1"},null):void 0,f.props.prependAvatar&&u(sl,{image:f.props.prependAvatar},null),f.props.prependIcon&&u(ee,{icon:f.props.prependIcon},null)])},title:()=>{var E,L;return p.value?f.title:rl(f.title,(E=fe(f))==null?void 0:E.title,((L=c.value)==null?void 0:L.length)??0)}})}}),(y=a["append-item"])==null?void 0:y.call(a)]}})]}),o.value.map((t,v)=>{function y(_){_.stopPropagation(),_.preventDefault(),V(t,!1)}const w={"onClick:close":y,onMousedown(_){_.preventDefault(),_.stopPropagation()},modelValue:!0,"onUpdate:modelValue":void 0},f=l?!!a.chip:!!a.selection,S=f?$e(l?a.chip({item:t,index:v,props:w}):a.selection({item:t,index:v})):void 0;if(!(f&&!S))return u("div",{key:t.value,class:["v-combobox__selection",v===s.value&&["v-combobox__selection--selected",ce.value]],style:v===s.value?ve.value:{}},[l?a.chip?u(Oe,{key:"chip-defaults",defaults:{VChip:{closable:e.closableChips,size:"small",text:t.title}}},{default:()=>[S]}):u(il,D({key:"chip",closable:e.closableChips,size:"small",text:t.title,disabled:t.props.disabled},w),null):S??u("span",{class:"v-combobox__selection-text"},[t.title,e.multiple&&v<o.value.length-1&&u("span",{class:"v-combobox__selection-comma"},[ze(",")])])])})]),"append-inner":function(){var w;for(var t=arguments.length,v=new Array(t),y=0;y<t;y++)v[y]=arguments[y];return u(O,null,[(w=a["append-inner"])==null?void 0:w.call(a,...v),(!e.hideNoData||e.items.length)&&e.menuIcon?u(ee,{class:"v-combobox__menu-icon",icon:e.menuIcon,onMousedown:xe,onClick:Ke,"aria-label":k(G.value),title:k(G.value)},null):void 0])}})}),ll({isFocused:b,isPristine:p,menu:r,search:c,selectionIndex:s,filteredItems:M,select:V},x)}}),wl=He({name:"AppCombobox",inheritAttrs:!1,__name:"AppCombobox",setup(e){const m=h(()=>{const a=le(),k=a.id||a.label;return k?`app-combobox-${k}-${Math.random().toString(36).slice(2,7)}`:void 0}),C=h(()=>le().label);return(a,k)=>(te(),je("div",{class:Ye(["app-combobox flex-grow-1",a.$attrs.class])},[B(C)?(te(),qe(_e,{key:0,for:B(m),class:"mb-1 text-body-2",text:B(C)},null,8,["for","text"])):Ge("",!0),u(vl,ae(ne({...a.$attrs,class:null,label:void 0,variant:"outlined",id:B(m),menuProps:{contentClass:["app-inner-list","app-combobox__content","v-combobox__content",a.$attrs.multiple!==void 0?"v-list-select-multiple":""]}})),Je({_:2},[We(a.$slots,(x,b)=>({name:b,fn:Qe(p=>[Xe(a.$slots,b,ae(ne(p||{})))])}))]),1040)],2))}});export{vl as V,wl as _};
